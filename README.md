# sale_agent
## Задача

Разработка Sales Агент для компании Napoleon IT Отзывы — это система интеллектуального анализа отзывов для брендов. 
Sales Агент должен стать ее интерактивным интерфейсом, между потенциальным покупателем системы и базой данных об уже 
проанализированных отзывах. В процессе общения с потенциальными клиентом, Sales Агент должен уметь грамотно рассказывать 
о продукте Napoleon IT Отзывы, а также отвечать на вопросы, связанные с проанализированными отзывами.

## Решение

Решением является Телеграм бот с 3 этапами внедрения, который свяжется с каждым клиентом, расскажет о продукте, 
проведет демо-презентацию, ответит на вопросы и подготовит потенциального покупателя к следующему шагу – обращению в 
отдел продаж.

- 1 Этап - Запуск сервиса на подготовку клиента к демо-презентации. 
  - На этом этапе клиент получает общую информацию о продукте и проявляет интерес.

- 2 Этап - Первое улучшение. 
  - Общение с клиентом происходит осмысленно. 
  - Бот знает клиента, чем он занимается, его возражения и потенциальные проблемы. 
  - Бот ведет диалог на 1-2 шага впереди клиента. 
  - Производит показ демо-презентации.

- 3 Этап - Бот с закрытой архитектурой. 
  - Общается о бизнесе клиента цифрами. 
  - Предоставляет аналитические графики, диаграммы, таблицы. 
  - Предоставляет сравнительный анализ похожих компаний-партнеров продукта. 
  - Подсвечивает точки роста. 
  - Работа происходит по заданному сценарию.

## Этап 1

### Архитектура решения
![LLA-LLA_pres.png](readme_files%2FLLA-LLA_pres.png)

### Модель БД


### Структура проекта
- **_alembic_** - утилитарная папка для alembic
- **_app_** - основная папка продукта
  - **_core_** - инициализация БД
  - **_models_** - ORM
  - **_routes_** - роутер телеграм бота
  - **_services_** - функции для бота и реализация ядра ML
  - **_tests_** - юниты (пусто, за пределами MVP)
  - **_utils_** - команды бота
  - **_app.py_** - файл запуска приложения
- **_scripts_** - 

#### DataBase
Во входном датасете был проведён EDA и следующие предобработки:
1. Избавление от дублей.
2. Группировка отзывов по топикам.
3. Выделение из текста отзыва единиц измерения товара и количества товара.

В продукте представлена нормализованная модель данных в соответствии с предобработанными данными.

![schema.png](readme_files%2Fschema.png)

#### ML Core
Ядро сервиса представляет собой реализацию LangChain цепочки в составе (элементы списка соответсвуют шагам ML пайплайна):
1. Кастомного дата лоадера ([review_service.py](app%2Fservices%2Freview_service.py))
   1. Асинхронная загрузка данных, начало пайпа.
2. Sentense Transformer ([embedding_service.py](app%2Fservices%2Fembedding_service.py))
   1. Сихронный компонент векторизации текста.
3. Векторного хранилища Chroma и методов работы с ним ([chroma_service.py](app%2Fservices%2Fchroma_service.py))
4. Сервиса логики лэнгчеина (получение промпта, получение аугментации)
5. Сервиса создания промпта ([prompt_service.py](app%2Fservices%2Fprompt_service.py))
6. Сервиса апи модели
   1. Генерация текста, конец пайпа.

Перспективные доработки:
1. LangGraph - Обеспечение стабильности выполнения сценариев.
2. Фильтрующая LLM - Обеспечение защиты от токсичного контента дополнительно к возможностям модели.
3. Генерация писем по CRON - Подключение CRON к БД компаний и отзывов, а также выполнение сценария генерации welcome письма.

Используемые модели:
1. YandexGPT - LLM для генерации текста. ML решение работает на токенах модели.
2. YandexEmbeddings - SentenceTransformer.

#### Open API
Выделенный интерфейс отсутствует. В MVP реализован роутер для TG бота. 
В будущем возможно выделение полноценного апи слоя без серьёзных доработок. 

#### GUI
![bot.jpg](readme_files%2Fbot.jpg)

### Запуск проекта
#### Заполнение .env
Файл .env не включён в состав репозитория в целях безопасности. Однако, создать такой файл можно по файлу примера .env.example:
- POSTGRES_* - параметры подключения к постгре.
- DATABASE_URL - полная ссылка для инициализации сессии.
- YANDEX_* - параметры подключения к моделям Yandex.
- TG_BOT_TOKEN - Токен TG юзера, запускающего бота.

#### Запуск сервиса
После создания файла .env необходимо выполнить команду docker-compose up. Произойдёт следующее:

1. Будут установлены requirements.txt.
2. Будут запущены следующие контейнеры:
app - файл бота.
db - инстанс БД
adminer - ??
chroma - инстанс векторной БД

У вас должна получиться следующая картинка:

![docker.jpg](readme_files%2Fdocker.jpg)

## Мотивация

Проект реализован командой “Улиточка” в рамках хакатона AI Product Hack организованный магистратурой по ИИ AI Talent Hub и компанией Napoleon IT.

[Распределение рабочего времени](https://wiki.yandex.ru/homepage/proekt-sale-agent/plan-zadach-i-vremeni/)

### Авторы

[Николай Хилькович](https://t.me/HIKKI010)

[Игорь Макаров](https://t.me/qeshtir)

[Екатерина Костюк](https://t.me/Jenova_13)

[Валерия Корнилова](https://t.me/va_vak)

[Павел Соколов](https://t.me/SPI_q)

### Лицензия

Этот проект распространяется по лицензии MIT.

### Благодарность

[AI Talent Hub](https://ai.itmo.ru/)

[Napoleon IT](https://napoleonit.ru/)
